## MySQL 服务器逻辑架构：一条 SELECT  语句的执行过程

MySQL 服务器逻辑架构图
![MySQL 服务器逻辑架构图](https://user-images.githubusercontent.com/19634532/58867220-a29b4780-86ec-11e9-9c33-945354b56f3b.png)

上图应该是「 执行器 」到「 查询缓存 」吧。

MySQL 可以分为 Server 层和存储引擎层。

- Server 层包括连接器、查询缓存、分析器、优化器、执行器等。涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这这一层实现，比如存储过程、触发器、视图等。
- 存储引擎层。存储引擎负责MySQL 数据的存储和提取。其架构是插件式的，MySQL 默认使用 InnoDB 存储引擎。

```
select * from table where id = 1;
```

### 连接器
每个客户端连接都会在服务器中拥有一个线程，这个连接的读写操作都会在这个单独的线程里执行。服务器会负责缓存线程，因此不需要每创建一个连接就创建和销毁线程。
当客户端连接到了 MySQL 上，连接器负责跟客户端建立连接，权限校验，维持和管理连接。


### 查询缓存
会先查询缓存，缓存中有直接返回结果，如果没有继续执行。执行完成后，执行结果会被存入查询缓存中。

查询缓存系统会跟踪查询中涉及的每个表，如果这些表发生变化，那么和这个表相关的所有的缓存都将失效。

MySQL 8.0 中移除查询缓存功能，用户升级后将被鼓励使用服务器端查询重写或 ProxySQL 作为中间缓存。



### 分析器

先 SQL 语句进行分析，先做词法分析，然后做语法分析。



### 优化器

在表里有多个索引的时候，决定用哪一个索引；有多表关联 join 的时候，决定表的连接顺序

TODO：

优化器是怎么选择索引的？



### 执行器

先判断对表有没有执行增删改查的权限，如果没有权限，返回没有权限的错误，如果有，打开表继续执行



[MySQL 实战45讲 01.基础架构：一条SQL查询语句是如何执行的？](https://time.geekbang.org/column/article/68319)
