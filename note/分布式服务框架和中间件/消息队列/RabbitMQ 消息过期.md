## RabbitMQ 消息过期

RabbitMQ 可以对队列和消息设置消息 TTL（Time to Live，过期时间）。



两种方式设置消息的 TTL，一种是对队列属性设置，队列中的消息都有相同的过期时间，一种是通过消息属性设置。如果两种方法一起用，则消息的 TTL 以最小的那个为准。

消息在队列中过期了就变成「 死信 」（Dead Message）。



如果不设置 TTL ，表示消息不会过期，如果设置 TTL 为 0，表示此时可以将消息投递给消费者，否则消息会被立即丢弃。



- 第一种设置队列 TTL 属性的方法，一旦消息过期，就会从队列中抹去。因为队列中已过期的消息肯定在队列头部，RabbitMQ只要定期从队头开始扫描是否有过期消息即可。
- 第二种方法里，即使消息过期，也不会马上从队列中抹去，因为每条消息是否过期时在即将投递到消费者之前判定的。因为每条消息的过期时间不同，如果要删除所有过期消息，就要扫描整个队列，所以不如等到此消息即将被消费时再判定是否过期，如果过期，再进行删除。



