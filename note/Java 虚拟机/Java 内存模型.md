## Java 内存模型

Java Memory Model，JMM



### 主内存与工作内存

Java 内存模型规定了所有的变量都存储在主内存中。

每条线程都有自己的工作内存，保存了被该线程使用到的变量的主内存副本拷贝 (对象的引用，对象被访问到的字段) ，线程对变量的读取都在工作内存中进行。不同线程之间无法访问对方工作内存中的变量。

主内存主要对应于 Java 堆中的对象实例数据部分，工作内存对应虚拟机栈中的部分区域。



#### 内存间交互操作
8种操作：lock，unlock，read，load，use，assign，store，write

相关文章：
[Java 内存模型-同步八种操作](https://blog.csdn.net/timchen525/article/details/80412699)



### volatile
轻量级的同步机制，大多数场景下 volatile 的总开销比加锁低。

**保证可见性**：

被 volatile 定义的变量，每次修改变量后都必须立即同步至主内存中，每次使用该变量都必须先从主内存刷新最新的值，保证能看见其他线程对该变量所做的修改。

只能保证可见性，不保证原子性

**保证有序性：**

内存屏障

禁止指令重排序



### 原子性、可见性和有序性



## 参考

- 《深入理解 Java 虚拟机 第2版》周志明


