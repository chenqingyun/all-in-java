## ThreadLocal

保存线程本地化对象的容器。当运行于多线程环境的某个对象使用 ThreadLocal 维护变量时，ThreadLocal 为每个使用该变量的线程分配一个独立的变量副本。所以每个线程都可以独立的改变自己的副本，不会影响到其他线程的副本。从线程角度看，这个变量就是线程独有的本地变量。



**ThreadLocal 如何做到为每个线程维护一份独立的变量副本呢？**

在 ThreadLocal 类中有一个 Map，用于存储每个线程的变量副本，Map 中元素的键为线程对象，值为对应线程的变量副本。



**ThreadLocal 与同步机制的比较**

- 在同步机制中，变量是多个线程共享的，通过对象的锁机制保证同一时间只有一个线程访问变量；
- ThreadLocal 为每个线程提供一个独立的变量副本，隔离了多个线程对访问数据的冲突。因为每个线程访问的是自己的变量副本，因此就不需要对变量进行同步。

概况来说，同步机制是「 以时间换空间 」的方式：访问串行化，对象共享化；ThreadLocal 是 「 以空间换时间」的方式：访问并行化，对象独享化。



如果需要进行多个线程之间进行通信，则使用同步机制；如果需要隔离多个线程之间的共享冲突，可以使用 ThreadLocal。